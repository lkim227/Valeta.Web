# Valeta Build

The provided `./build_and_copy.sh` script builds the assets in a docker container and copies the build artifacts to the current working directory

## Docker Build

The provided `Dockerfile` builds the assets for `production` mode. There are several different build targets defined in the gulpfile, modify the last line of the docker to build for other environments

## Move build artifacts

In `./build_and_copy.sh` There is a list of build artifacts and directories that will be copied over to the current working directory. This includes the two main build assets, `valeta-app.js` and `valeta-lib.js`, the `index.html` and several subdirectories that may or may not be needed for the app to function.

We shell into the built container and use a shared volume to move the assets described above onto the host machine.


### 1. **Bash Script (Linux/macOS) – `build_and_copy.sh`**

```bash
#!/bin/bash

# Get the absolute path to the current directory (project root)
PROJECT_DIR=$(pwd)

# Step 1: Build the Docker image
echo "Building Docker image..."
docker build -t angular-app .

# Step 2: Run the Docker container and copy the build files to the host
echo "Running Docker container to copy build files..."
docker run -it --rm -v "$PROJECT_DIR:/usr/src/host" angular-app /bin/bash -c "\
  cp /usr/src/app/valeta-app.js /usr/src/host/ && \
  cp /usr/src/app/valeta-lib.js /usr/src/host/ && \
  cp /usr/src/app/index.html /usr/src/host/"

# Final message
echo "Build and copy complete! Files copied to: $PROJECT_DIR"
```

### 2. **Batch Script (Windows) – `build_and_copy.bat`**

```batch
@echo off
:: Get the current directory and store it in a variable
set PROJECT_DIR=%cd%

:: Step 1: Build the Docker image
echo Building Docker image...
docker build -t angular-app .

:: Step 2: Run the Docker container and copy the build files to the host
echo Running Docker container to copy build files...
docker run -it --rm -v "%PROJECT_DIR%:/usr/src/host" angular-app /bin/bash -c "cp /usr/src/app/valeta-app.js /usr/src/host/ && cp /usr/src/app/valeta-lib.js /usr/src/host/ && cp /usr/src/app/index.html /usr/src/host/"

:: Final message
echo Build and copy complete! Files copied to: %PROJECT_DIR%
pause
```

### 3. **README File**

Here’s the **README.md** file that explains how your client can use these scripts to automate the build and copy process.

---

## README

### Overview

This project contains automated scripts to build the **AngularJS frontend** using Docker and automatically copy the generated files to your local machine.

The key files generated by the build process are:
- `valeta-app.js`
- `valeta-lib.js`
- `index.html`

### Prerequisites

Ensure you have the following installed:
- Docker (https://www.docker.com/)
- Git (if you're on Windows)

---

### Instructions

#### **For Linux/macOS Users:**

1. **Run the Build and Copy Script:**

   You can automate the Docker build process and copy the files to your local machine by using the `build_and_copy.sh` script.

   **Steps:**
   
   - Open a terminal.
   - Navigate to the project directory.
   - Run the following command to make the script executable:
     ```bash
     chmod +x build_and_copy.sh
     ```
   - Run the script:
     ```bash
     ./build_and_copy.sh
     ```

   The script will:
   - Build the Docker image.
   - Run the container.
   - Copy the generated files (`valeta-app.js`, `valeta-lib.js`, `index.html`) to your project directory.

2. **Files Location:**
   After running the script, the generated files will be available in the same directory as the `build_and_copy.sh` script.

---

#### **For Windows Users:**

1. **Run the Build and Copy Script:**

   You can automate the Docker build process and copy the files to your local machine by using the `build_and_copy.bat` script.

   **Steps:**
   
   - Open a Command Prompt (CMD) window.
   - Navigate to the project directory where the `build_and_copy.bat` file is located.
   - Double-click `build_and_copy.bat` or run it using CMD:
     ```cmd
     build_and_copy.bat
     ```

   The script will:
   - Build the Docker image.
   - Run the container.
   - Copy the generated files (`valeta-app.js`, `valeta-lib.js`, `index.html`) to your project directory.

2. **Files Location:**
   After running the script, the generated files will be available in the same directory as the `build_and_copy.bat` script.

---

### Troubleshooting

1. **Docker Permissions:**
   - If you encounter issues running Docker, ensure that you have the necessary permissions. You may need to run the command with `sudo` on Linux/macOS or run your Command Prompt as Administrator on Windows.

2. **Docker Installation:**
   - Ensure Docker is installed and running. You can check the Docker installation by running:
     ```bash
     docker --version
     ```

3. **File Copy Issues:**
   - Ensure that the project directory is properly mapped as a volume to the Docker container. The scripts automatically handle this, but if files don’t appear, verify that Docker has access to your directory.

---

### Summary

The provided `.sh` (Linux/macOS) and `.bat` (Windows) scripts make it easy to automate the Docker build process and file copying. Once you’ve run the script, the files (`valeta-app.js`, `valeta-lib.js`, and `index.html`) will be available in the project directory, ready for further use.
