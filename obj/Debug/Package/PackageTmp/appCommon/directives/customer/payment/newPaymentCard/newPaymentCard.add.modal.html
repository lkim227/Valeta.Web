<!--controllers: 'addVm',-->

<div class="modal-header">
    <button type="button"
            class="close"
            aria-label="Close"
            ng-click="addVm.cancelAddNewPaymentCard();">
        <span aria-hidden="true">&times;</span>
    </button>
    <h4 class="modal-title">{{addVm.pageTitle}}</h4>
</div>

<div cg-busy="addVm.loadingPromise">
    <form id="addPaymentMethodForm"
          name="addPaymentMethodForm"
          autocomplete="on"
          data-card
          data-width="250"
          data-card-container="#card-container"
          data-placeholders="addVm.cardPlaceholders"
          data-options="addVm.cardOptions"
          data-messages="addVm.cardMessages"
          novalidate>

        <div class="form-horizontal modal-body add-payment card-row">

            <div class="card-container" id="card-container"></div>

            <div class="card-info-group">

                <div class="form-group">
                    <label class="form-col-withlabel-label control-label" for="cardnumber">Card Number</label>
                    <div class="form-col-withlabel-input">
                        <input class="form-control" type="text" card-number name="cardnumber" autocompletetype="cc-number" required data-ng-model="addVm.newPaymentCard.CardNumber">

                        <div class="error-messages" ng-messages="addPaymentMethodForm.cardnumber.$error" ng-if="addPaymentMethodForm.cardnumber.$dirty || addPaymentMethodForm.$submitted">
                            <div ng-message="required">{{addVm.formMessages.Required_Card_Number}}</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-col-withlabel-label control-label" for="expiration">Expiration</label>
                    <div class="form-col-withlabel-input">
                        <input class="form-control" placeholder="MM / 20YY" type="text" name="expiration" card-expiry required
                               data-ng-model="addVm.newPaymentCard.ExpirationMonthAndYear"
                               ng-pattern="/^\d{2} ?/? ?20\d{2}/" />

                        <div class="error-messages" ng-messages="addPaymentMethodForm.expiration.$error" ng-if="addPaymentMethodForm.expiration.$touched || addPaymentMethodForm.$submitted">
                            <div ng-message="required">{{addVm.formMessages.Required_Card_Expiration}}</div>
                            <div ng-message="pattern">{{addVm.formMessages.Required_Card_Expiration_Pattern}}</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-col-withlabel-label control-label" for="ccv">CCV</label>
                    <div class="form-col-withlabel-input">
                        <input class="form-control" placeholder="CCV" type="text" name="ccv" card-cvc data-ng-model="addVm.newPaymentCard.CCV" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-col-withlabel-label control-label" for="notes">Nickname</label>
                    <div class="form-col-withlabel-input">
                        <input class="form-control" type="text" name="notes" placeholder="e.g. Business" ng-model="addVm.newPaymentCard.Note" />
                    </div>
                </div>
            </div>

        </div>
        
        <div id="addressRowDescription" style="margin-top: 15px">
            <span>
                <span style="margin-left: 30px; font-size: large;">Billing Address</span>
                <span style="margin-left: 30px" class="form-check" ng-show="addVm.canUseMailingAddress">
                    <input class="form-check-input" type="checkbox" ng-model="addVm.useContactAddress" ng-change="addVm.useContactAddressChanged()">
                    <label class="form-check-label" for="defaultCheck1">
                        Same as mailing address
                    </label>
                </span>
            </span>
        </div>

        <div id="addressRow" class="input-group input-group--multi form-row" style="width: 90%; margin: 15px 12px">
            <div class="form-horizontal">
                <div class="form-group">
                    <label class="form-col-withlabel-label control-label" for="addressLine1">{{addVm.formMessages.Label_Address_1}}</label>
                    <div class="form-col-withlabel-input">
                        <input class="form-control" type="text" id="addressLine1" name="addressLine1" ng-model="addVm.newPaymentCard.BillingAddress.Line1" />
                    </div>
                </div>
                <!--<div class="form-group">
                    <label class="form-col-withlabel-label control-label" for="addressLine2">{{addVm.formMessages.Label_Address_2}}</label>
                    <div class="form-col-withlabel-input">
                        <input class="form-control" type="text" id="addressLine2" name="addressLine2" ng-model="addVm.newPaymentCard.BillingAddress.Line2" />
                    </div>
                </div>-->
                <div class="form-group">
                    <label class="form-col-withlabel-label control-label" for="city">{{addVm.formMessages.Label_City}}</label>
                    <div class="form-col-withlabel-input">
                        <input class="form-control" type="text" id="city" name="city" ng-model="addVm.newPaymentCard.BillingAddress.City" />
                    </div>
                </div>

                <div>
                    <div class="form-group">
                        <defined-list-dropdown list-type="State" 
                                               list-label="{{addVm.formMessages.Label_State}}" 
                                               name="State"
                                               required data-required-msg="State is required"
                                               selected-defined-list-value="addVm.newPaymentCard.BillingAddress.State" />
                    </div>

                    <div class="form-group">
                        <label class="form-col-withlabel-label control-label" for="zip">{{addVm.formMessages.Label_Zip}}</label>
                        <div class="form-col-withlabel-input">
                            <input class="form-control" type="text" id="zip" 
                                   name="zip" 
                                   required data-required-msg="Zip is required"
                                   ng-model="addVm.newPaymentCard.BillingAddress.PostalCode" />
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="modal-footer">
            <button type="button" ng-click="addVm.saveNewPaymentCard();" class="btn btn-primary" ng-disabled="!addPaymentMethodForm.$valid">Save Changes</button>
            <button type="button" class="btn btn-cancel" ng-click="addVm.cancelAddNewPaymentCard();">Cancel</button>
        </div>
    </form>
</div>